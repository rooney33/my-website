// 단어 데이터 - Lecture(챕터)별로 구성
const vocaData = [
  // -----------------------------------------------------------
  // 1. TOEIC & Business English
  // -----------------------------------------------------------
  {
    lecture: "Chapter 1: TOEIC",
    words: [
      {
        word: "Accommodate",
        meaning: "수용하다, 편의를 봐주다",
        example: "The hall can accommodate 500 people.",
      },
      {
        word: "Affordable",
        meaning: "감당할 수 있는, 저렴한",
        example: "They offer affordable housing options.",
      },
      {
        word: "Agenda",
        meaning: "안건, 의제",
        example: "The first item on the agenda is the budget.",
      },
      {
        word: "Applicant",
        meaning: "지원자",
        example: "We have many qualified applicants.",
      },
      {
        word: "Authorization",
        meaning: "허가, 승인",
        example: "You need authorization to enter.",
      },
      {
        word: "Banquet",
        meaning: "연회",
        example: "The annual banquet will be held tonight.",
      },
      {
        word: "Beneficial",
        meaning: "유익한",
        example: "The deal was beneficial to both parties.",
      },
      {
        word: "Collaboration",
        meaning: "협력",
        example: "The project was a successful collaboration.",
      },
      {
        word: "Commence",
        meaning: "시작하다",
        example: "The ceremony will commence at noon.",
      },
      {
        word: "Compensate",
        meaning: "보상하다",
        example: "Workers were compensated for their overtime.",
      },
      {
        word: "Complimentary",
        meaning: "무료의",
        example: "Guests receive a complimentary breakfast.",
      },
      {
        word: "Comply",
        meaning: "준수하다, 따르다",
        example: "All staff must comply with the rules.",
      },
      {
        word: "Confidential",
        meaning: "기밀의",
        example: "Keep these documents confidential.",
      },
      {
        word: "Consistently",
        meaning: "일관되게, 지속적으로",
        example: "He consistently meets his targets.",
      },
      {
        word: "Deficit",
        meaning: "적자",
        example: "We aim to reduce the budget deficit.",
      },
      {
        word: "Designate",
        meaning: "지정하다",
        example: "Please park in the designated area.",
      },
      {
        word: "Discrepancy",
        meaning: "불일치, 차이",
        example: "There is a discrepancy in the figures.",
      },
      {
        word: "Eligible",
        meaning: "자격이 있는",
        example: "You are eligible for a promotion.",
      },
      {
        word: "Endorse",
        meaning: "지지하다, 홍보하다",
        example: "The celebrity endorsed the product.",
      },
      {
        word: "Exceed",
        meaning: "초과하다",
        example: "Do not exceed the speed limit.",
      },
      {
        word: "Extension",
        meaning: "연장, 내선 번호",
        example: "Can I have an extension on the deadline?",
      },
      {
        word: "Fluctuation",
        meaning: "변동, 오르내림",
        example: "Market fluctuations are normal.",
      },
      {
        word: "Implement",
        meaning: "시행하다",
        example: "We will implement the new policy soon.",
      },
      {
        word: "Incentive",
        meaning: "장려금, 혜택",
        example: "Sales staff receive cash incentives.",
      },
      {
        word: "Itinerary",
        meaning: "여행 일정",
        example: "Check your itinerary for flight details.",
      },
      {
        word: "Liability",
        meaning: "법적 책임, 부채",
        example: "The company denied liability for the damage.",
      },
      {
        word: "Mandatory",
        meaning: "의무적인",
        example: "Attendance is mandatory for all employees.",
      },
      {
        word: "Merger",
        meaning: "합병",
        example: "The merger created a global giant.",
      },
      {
        word: "Negotiation",
        meaning: "협상",
        example: "The contract is under negotiation.",
      },
      {
        word: "Outstanding",
        meaning: "뛰어난, 미지불된",
        example: "He has an outstanding balance on his account.",
      },
      {
        word: "Permanent",
        meaning: "영구적인",
        example: "She is looking for a permanent job.",
      },
      {
        word: "Postpone",
        meaning: "연기하다",
        example: "The meeting was postponed until Monday.",
      },
      {
        word: "Productivity",
        meaning: "생산성",
        example: "New software improved productivity.",
      },
      {
        word: "Prohibit",
        meaning: "금지하다",
        example: "Smoking is prohibited in the building.",
      },
      {
        word: "Promote",
        meaning: "승진시키다, 홍보하다",
        example: "He was promoted to manager.",
      },
      {
        word: "Punctual",
        meaning: "시간을 엄수하는",
        example: "Please be punctual for the interview.",
      },
      {
        word: "Recruit",
        meaning: "채용하다",
        example: "We are recruiting new engineers.",
      },
      {
        word: "Reimburse",
        meaning: "환급하다, 변제하다",
        example: "The company will reimburse travel expenses.",
      },
      {
        word: "Renovation",
        meaning: "개조, 보수",
        example: "The office is closed for renovation.",
      },
      {
        word: "Resignation",
        meaning: "사임, 사직",
        example: "He handed in his resignation yesterday.",
      },
      {
        word: "Revenue",
        meaning: "수익, 매출",
        example: "Advertising revenue has increased.",
      },
      {
        word: "Specification",
        meaning: "사양, 설명서",
        example: "The product meets all specifications.",
      },
      {
        word: "Substantial",
        meaning: "상당한",
        example: "There was a substantial increase in sales.",
      },
      {
        word: "Tentative",
        meaning: "잠정적인",
        example: "We have a tentative agreement.",
      },
      {
        word: "Termination",
        meaning: "종료, 해고",
        example: "Termination of the contract requires notice.",
      },
      {
        word: "Unanimous",
        meaning: "만장일치의",
        example: "The board made a unanimous decision.",
      },
      {
        word: "Vacancy",
        meaning: "공석, 빈방",
        example: "There is a vacancy in the sales department.",
      },
      {
        word: "Valid",
        meaning: "유효한",
        example: "This coupon is valid for one month.",
      },
      {
        word: "Warranty",
        meaning: "보증(서)",
        example: "The laptop is under warranty.",
      },
      {
        word: "Withdraw",
        meaning: "철회하다, 인출하다",
        example: "He decided to withdraw his application.",
      },
    ],
  },
  // -----------------------------------------------------------
  // 2. Data Structures & Algorithms
  // -----------------------------------------------------------
  {
    lecture: "Chapter 2: Data Structures & Algorithms",
    words: [
      {
        word: "Algorithm",
        meaning: "알고리즘",
        example: "Sorting algorithms are essential for data processing.",
      },
      {
        word: "Data Structure",
        meaning: "자료구조",
        example: "Stacks and queues are basic data structures.",
      },
      {
        word: "Time Complexity",
        meaning: "시간 복잡도",
        example: "We express time complexity using Big O notation.",
      },
      {
        word: "Space Complexity",
        meaning: "공간 복잡도",
        example: "Recursion often increases space complexity.",
      },
      {
        word: "Recursion",
        meaning: "재귀",
        example: "Recursion is a function calling itself.",
      },
      {
        word: "Linked List",
        meaning: "연결 리스트",
        example: "Linked lists allow dynamic memory allocation.",
      },
      {
        word: "Stack",
        meaning: "스택 (LIFO)",
        example: "Undo operations usually use a stack.",
      },
      {
        word: "Queue",
        meaning: "큐 (FIFO)",
        example: "Printers use a queue to manage jobs.",
      },
      {
        word: "Hash Table",
        meaning: "해시 테이블",
        example: "Hash tables offer fast data retrieval.",
      },
      {
        word: "Binary Search Tree",
        meaning: "이진 탐색 트리",
        example: "BST allows for efficient searching.",
      },
      {
        word: "Graph",
        meaning: "그래프",
        example: "Social networks can be modeled as graphs.",
      },
      {
        word: "Depth-First Search",
        meaning: "깊이 우선 탐색 (DFS)",
        example: "DFS explores as far as possible along each branch.",
      },
      {
        word: "Breadth-First Search",
        meaning: "너비 우선 탐색 (BFS)",
        example: "BFS visits neighbor nodes first.",
      },
      {
        word: "Dynamic Programming",
        meaning: "동적 계획법",
        example: "DP breaks problems into simpler subproblems.",
      },
      {
        word: "Sorting",
        meaning: "정렬",
        example: "Quick sort is a widely used sorting algorithm.",
      },
      {
        word: "Bubble Sort",
        meaning: "버블 정렬",
        example: "Bubble sort is simple but inefficient.",
      },
      {
        word: "Merge Sort",
        meaning: "병합 정렬",
        example: "Merge sort uses a divide and conquer strategy.",
      },
      {
        word: "Heap",
        meaning: "힙 (자료구조)",
        example: "Heaps are used to implement priority queues.",
      },
      {
        word: "Priority Queue",
        meaning: "우선순위 큐",
        example: "A priority queue processes high-priority elements first.",
      },
      {
        word: "Adjacency Matrix",
        meaning: "인접 행렬",
        example: "Graphs can be represented using an adjacency matrix.",
      },
      {
        word: "Adjacency List",
        meaning: "인접 리스트",
        example: "Adjacency lists save space for sparse graphs.",
      },
      {
        word: "Shortest Path",
        meaning: "최단 경로",
        example: "Dijkstra's algorithm finds the shortest path.",
      },
      {
        word: "Minimum Spanning Tree",
        meaning: "최소 신장 트리",
        example: "Kruskal's algorithm finds the MST.",
      },
      {
        word: "Greedy Algorithm",
        meaning: "탐욕 알고리즘",
        example: "Greedy algorithms make the locally optimal choice.",
      },
      {
        word: "Backtracking",
        meaning: "백트래킹",
        example: "Backtracking is used to solve Sudoku puzzles.",
      },
      {
        word: "Divide and Conquer",
        meaning: "분할 정복",
        example: "Merge sort is a divide and conquer algorithm.",
      },
      {
        word: "Pointer",
        meaning: "포인터",
        example: "Pointers store memory addresses.",
      },
      { word: "Array", meaning: "배열", example: "Arrays have a fixed size." },
      {
        word: "String Manipulation",
        meaning: "문자열 조작",
        example: "String manipulation is common in coding tests.",
      },
      {
        word: "Bitwise Operation",
        meaning: "비트 연산",
        example: "Bitwise operations are fast and efficient.",
      },
      {
        word: "Binary Search",
        meaning: "이진 탐색",
        example: "Binary search requires a sorted array.",
      },
      {
        word: "Two Pointers",
        meaning: "투 포인터",
        example: "The two pointers technique optimizes loop usage.",
      },
      {
        word: "Sliding Window",
        meaning: "슬라이딩 윈도우",
        example: "Sliding window is useful for subarray problems.",
      },
      {
        word: "Memoization",
        meaning: "메모이제이션",
        example: "Memoization caches results of function calls.",
      },
      {
        word: "Topological Sort",
        meaning: "위상 정렬",
        example: "Topological sort is used for scheduling tasks.",
      },
      {
        word: "Trie",
        meaning: "트라이 (자료구조)",
        example: "Tries are used for autocomplete features.",
      },
      {
        word: "Union-Find",
        meaning: "유니온 파인드",
        example: "Union-Find tracks disjoint sets.",
      },
      {
        word: "Segment Tree",
        meaning: "세그먼트 트리",
        example: "Segment trees are used for range queries.",
      },
      {
        word: "Floyd-Warshall",
        meaning: "플로이드-워셜",
        example: "Floyd-Warshall finds all-pairs shortest paths.",
      },
      {
        word: "Big O Notation",
        meaning: "빅오 표기법",
        example: "Big O describes the worst-case scenario.",
      },
    ],
  },

  // -----------------------------------------------------------
  // 3. ADsP & Data Science
  // -----------------------------------------------------------
  {
    lecture: "Chapter 3: ADsP & 데이터 분석",
    words: [
      {
        word: "Data Mining",
        meaning: "데이터 마이닝",
        example: "Data mining discovers patterns in large datasets.",
      },
      {
        word: "Big Data",
        meaning: "빅데이터",
        example: "Big data requires specialized processing tools.",
      },
      {
        word: "CRM",
        meaning: "고객 관계 관리",
        example: "CRM helps manage customer interactions.",
      },
      {
        word: "SCM",
        meaning: "공급망 관리",
        example: "SCM optimizes the flow of goods.",
      },
      {
        word: "ERP",
        meaning: "전사적 자원 관리",
        example: "ERP integrates core business processes.",
      },
      {
        word: "Descriptive Statistics",
        meaning: "기술 통계",
        example: "Descriptive statistics summarize data features.",
      },
      {
        word: "Inference Statistics",
        meaning: "추론 통계",
        example: "Inference statistics make predictions about populations.",
      },
      {
        word: "Variable",
        meaning: "변수",
        example: "Age is a continuous variable.",
      },
      {
        word: "Qualitative Data",
        meaning: "질적 데이터",
        example: "Colors and names are qualitative data.",
      },
      {
        word: "Quantitative Data",
        meaning: "양적 데이터",
        example: "Height and weight are quantitative data.",
      },
      {
        word: "Mean",
        meaning: "평균",
        example: "The mean is the average of the numbers.",
      },
      {
        word: "Median",
        meaning: "중앙값",
        example: "The median is the middle value in a sorted list.",
      },
      {
        word: "Mode",
        meaning: "최빈값",
        example: "The mode is the most frequent value.",
      },
      {
        word: "Variance",
        meaning: "분산",
        example: "Variance measures how far numbers are spread out.",
      },
      {
        word: "Standard Deviation",
        meaning: "표준편차",
        example: "Low standard deviation means data is clustered.",
      },
      {
        word: "Correlation",
        meaning: "상관관계",
        example: "Correlation does not imply causation.",
      },
      {
        word: "Hypothesis Testing",
        meaning: "가설 검정",
        example: "Hypothesis testing evaluates an assumption.",
      },
      {
        word: "Null Hypothesis",
        meaning: "귀무 가설",
        example: "We aim to reject the null hypothesis.",
      },
      {
        word: "Alternative Hypothesis",
        meaning: "대립 가설",
        example: "The alternative hypothesis suggests a difference.",
      },
      {
        word: "P-value",
        meaning: "유의 확률 (P값)",
        example: "A low P-value indicates statistical significance.",
      },
      {
        word: "Regression Analysis",
        meaning: "회귀 분석",
        example: "Regression analysis predicts continuous outcomes.",
      },
      {
        word: "Classification",
        meaning: "분류",
        example: "Spam detection is a classification problem.",
      },
      {
        word: "Clustering",
        meaning: "군집화",
        example: "K-means is a clustering algorithm.",
      },
      {
        word: "Decision Tree",
        meaning: "의사결정 나무",
        example: "Decision trees are easy to interpret.",
      },
      {
        word: "Neural Network",
        meaning: "신경망",
        example: "Neural networks mimic the human brain.",
      },
      {
        word: "Support Vector Machine",
        meaning: "서포트 벡터 머신 (SVM)",
        example: "SVM is used for classification tasks.",
      },
      {
        word: "Ensemble",
        meaning: "앙상블",
        example: "Ensemble methods combine multiple models.",
      },
      {
        word: "Random Forest",
        meaning: "랜덤 포레스트",
        example: "Random forest avoids overfitting.",
      },
      {
        word: "Overfitting",
        meaning: "과적합",
        example: "Overfitting performs well on training data only.",
      },
      {
        word: "Underfitting",
        meaning: "과소적합",
        example: "Underfitting fails to capture trends.",
      },
      {
        word: "Validation Set",
        meaning: "검증 세트",
        example: "Tune hyperparameters using the validation set.",
      },
      {
        word: "Test Set",
        meaning: "테스트 세트",
        example: "Evaluate the final model on the test set.",
      },
      {
        word: "Confusion Matrix",
        meaning: "오차 행렬",
        example: "A confusion matrix shows true positives and negatives.",
      },
      {
        word: "Accuracy",
        meaning: "정확도",
        example: "Accuracy is the ratio of correct predictions.",
      },
      {
        word: "Precision",
        meaning: "정밀도",
        example: "Precision minimizes false positives.",
      },
      {
        word: "Recall",
        meaning: "재현율",
        example: "Recall finds all positive instances.",
      },
      {
        word: "F1 Score",
        meaning: "F1 점수",
        example: "F1 score balances precision and recall.",
      },
      {
        word: "Time Series",
        meaning: "시계열",
        example: "Stock prices are time series data.",
      },
      {
        word: "Trend",
        meaning: "추세",
        example: "Identify the long-term trend.",
      },
      {
        word: "Seasonality",
        meaning: "계절성",
        example: "Ice cream sales show seasonality.",
      },
      {
        word: "Visualization",
        meaning: "시각화",
        example: "Data visualization helps insights.",
      },
      {
        word: "Histogram",
        meaning: "히스토그램",
        example: "A histogram shows data distribution.",
      },
      {
        word: "Scatter Plot",
        meaning: "산점도",
        example: "Use a scatter plot to see correlations.",
      },
      {
        word: "Box Plot",
        meaning: "상자 그림",
        example: "Box plots display outliers.",
      },
      {
        word: "SQL",
        meaning: "SQL",
        example: "SQL is standard for relational databases.",
      },
      {
        word: "DBMS",
        meaning: "데이터베이스 관리 시스템",
        example: "Oracle is a popular DBMS.",
      },
      {
        word: "ETL",
        meaning: "추출, 변환, 적재",
        example: "ETL processes move data to warehouses.",
      },
      {
        word: "Data Warehouse",
        meaning: "데이터 웨어하우스",
        example: "Warehouses store historical data.",
      },
      {
        word: "Unstructured Data",
        meaning: "비정형 데이터",
        example: "Images and text are unstructured data.",
      },
      {
        word: "Association Rule",
        meaning: "연관 규칙",
        example: "Market basket analysis uses association rules.",
      },
    ],
  },
  // -----------------------------------------------------------
  // 4. AI & Deep Learning (Specialization)
  // -----------------------------------------------------------
  {
    lecture: "Chapter 4: AI & Deep Learning ",
    words: [
      {
        word: "Perceptron",
        meaning: "퍼셉트론 (인공신경망의 기본 단위)",
        example: "A perceptron mimics a biological neuron.",
      },
      {
        word: "Multilayer Perceptron (MLP)",
        meaning: "다층 퍼셉트론",
        example: "MLP consists of input, hidden, and output layers.",
      },
      {
        word: "Feedforward",
        meaning: "순전파",
        example: "Data flows in one direction during feedforward.",
      },
      {
        word: "Backpropagation",
        meaning: "역전파",
        example: "Backpropagation is used to calculate gradients.",
      },
      {
        word: "Gradient Descent",
        meaning: "경사 하강법",
        example: "Gradient descent minimizes the error function.",
      },
      {
        word: "Stochastic Gradient Descent (SGD)",
        meaning: "확률적 경사 하강법",
        example: "SGD updates weights using a single sample.",
      },
      {
        word: "Learning Rate",
        meaning: "학습률",
        example: "A learning rate scheduler adjusts the rate during training.",
      },
      {
        word: "Epoch",
        meaning: "에포크 (전체 데이터 학습 주기)",
        example: "The model was trained for 100 epochs.",
      },
      {
        word: "Mini-batch",
        meaning: "미니 배치",
        example: "Training with mini-batches is more efficient.",
      },
      {
        word: "Activation Function",
        meaning: "활성화 함수",
        example: "ReLU is a popular activation function.",
      },
      {
        word: "Sigmoid",
        meaning: "시그모이드 함수",
        example: "Sigmoid outputs values between 0 and 1.",
      },
      {
        word: "Softmax",
        meaning: "소프트맥스 함수",
        example: "Softmax is used for multi-class classification.",
      },
      {
        word: "ReLU (Rectified Linear Unit)",
        meaning: "ReLU 함수",
        example: "ReLU solves the vanishing gradient problem.",
      },
      {
        word: "Loss Function",
        meaning: "손실 함수",
        example: "Cross-entropy is a common loss function.",
      },
      {
        word: "Optimizer",
        meaning: "최적화 알고리즘",
        example: "Adam is a widely used optimizer.",
      },
      {
        word: "Overfitting",
        meaning: "과적합",
        example: "Dropout helps prevent overfitting.",
      },
      {
        word: "Underfitting",
        meaning: "과소적합",
        example: "Underfitting occurs when the model is too simple.",
      },
      {
        word: "Regularization",
        meaning: "정규화 (L1, L2)",
        example: "L2 regularization adds a penalty term.",
      },
      {
        word: "Dropout",
        meaning: "드롭아웃",
        example: "Dropout randomly deactivates neurons.",
      },
      {
        word: "Batch Normalization",
        meaning: "배치 정규화",
        example: "Batch normalization accelerates training.",
      },
      {
        word: "CNN (Convolutional Neural Network)",
        meaning: "합성곱 신경망",
        example: "CNNs are excellent for image recognition.",
      },
      {
        word: "Pooling",
        meaning: "풀링 (Max/Average)",
        example: "Max pooling reduces the feature map size.",
      },
      {
        word: "Padding",
        meaning: "패딩",
        example: "Padding preserves the spatial dimensions.",
      },
      {
        word: "Stride",
        meaning: "스트라이드 (보폭)",
        example: "Increasing stride reduces output size.",
      },
      {
        word: "RNN (Recurrent Neural Network)",
        meaning: "순환 신경망",
        example: "RNNs process sequential data like text.",
      },
      {
        word: "LSTM (Long Short-Term Memory)",
        meaning: "LSTM",
        example: "LSTM overcomes the vanishing gradient problem in RNNs.",
      },
      {
        word: "Transformer",
        meaning: "트랜스포머",
        example: "Transformers rely on attention mechanisms.",
      },
      {
        word: "Attention Mechanism",
        meaning: "어텐션 메커니즘",
        example: "Attention allows the model to focus on key parts.",
      },
      {
        word: "Self-Attention",
        meaning: "셀프 어텐션",
        example: "Self-attention relates different positions of a sequence.",
      },
      {
        word: "BERT",
        meaning: "BERT (구글의 언어 모델)",
        example: "BERT is pre-trained on a large corpus.",
      },
      {
        word: "GPT",
        meaning: "GPT (생성형 사전학습 변환기)",
        example: "GPT models are good at text generation.",
      },
      {
        word: "LLM (Large Language Model)",
        meaning: "거대 언어 모델",
        example: "ChatGPT is based on an LLM.",
      },
      {
        word: "Tokenization",
        meaning: "토큰화",
        example: "Tokenization splits text into smaller units.",
      },
      {
        word: "Embedding",
        meaning: "임베딩",
        example: "Word embeddings represent words as vectors.",
      },
      {
        word: "Fine-tuning",
        meaning: "파인 튜닝 (미세 조정)",
        example: "We fine-tuned the model on our dataset.",
      },
      {
        word: "Transfer Learning",
        meaning: "전이 학습",
        example: "Transfer learning saves training time.",
      },
      {
        word: "Hyperparameter",
        meaning: "하이퍼파라미터",
        example: "Grid search helps find optimal hyperparameters.",
      },
      {
        word: "Tensor",
        meaning: "텐서",
        example: "PyTorch operations are performed on tensors.",
      },
      {
        word: "Inference",
        meaning: "추론",
        example: "The model is deployed for real-time inference.",
      },
      {
        word: "GPU Acceleration",
        meaning: "GPU 가속",
        example: "CUDA enables GPU acceleration for deep learning.",
      },
    ],
  },

  // -----------------------------------------------------------
  // 5. Computer Networks (CS Major)
  // -----------------------------------------------------------
  {
    lecture: "Chapter 5: Computer Networks",
    words: [
      {
        word: "OSI 7 Layer",
        meaning: "OSI 7계층",
        example: "The OSI model standardizes communication functions.",
      },
      {
        word: "Application Layer",
        meaning: "응용 계층 (L7)",
        example: "HTTP operates at the application layer.",
      },
      {
        word: "Transport Layer",
        meaning: "전송 계층 (L4)",
        example: "TCP and UDP are transport layer protocols.",
      },
      {
        word: "Network Layer",
        meaning: "네트워크 계층 (L3)",
        example: "IP addressing happens at the network layer.",
      },
      {
        word: "Data Link Layer",
        meaning: "데이터 링크 계층 (L2)",
        example: "Ethernet is a data link layer technology.",
      },
      {
        word: "Physical Layer",
        meaning: "물리 계층 (L1)",
        example: "Cables and signals are part of the physical layer.",
      },
      {
        word: "Encapsulation",
        meaning: "캡슐화",
        example: "Data is encapsulated with headers.",
      },
      {
        word: "Packet",
        meaning: "패킷",
        example: "Data is transmitted in small packets.",
      },
      {
        word: "Frame",
        meaning: "프레임",
        example: "Frames are the data units of the data link layer.",
      },
      {
        word: "TCP (Transmission Control Protocol)",
        meaning: "TCP",
        example: "TCP ensures reliable data transmission.",
      },
      {
        word: "UDP (User Datagram Protocol)",
        meaning: "UDP",
        example: "Streaming services often use UDP for speed.",
      },
      {
        word: "Three-way Handshake",
        meaning: "3방향 핸드셰이크",
        example: "TCP connection is established via a 3-way handshake.",
      },
      {
        word: "IP Address",
        meaning: "IP 주소",
        example: "IPv4 addresses consist of four numbers.",
      },
      {
        word: "MAC Address",
        meaning: "MAC 주소 (물리 주소)",
        example: "Every network card has a unique MAC address.",
      },
      {
        word: "Port Number",
        meaning: "포트 번호",
        example: "Web servers typically listen on port 80.",
      },
      {
        word: "Socket",
        meaning: "소켓",
        example: "A socket is an endpoint for communication.",
      },
      {
        word: "DNS (Domain Name System)",
        meaning: "DNS",
        example: "DNS translates domain names to IP addresses.",
      },
      {
        word: "DHCP",
        meaning: "DHCP (동적 호스트 구성 프로토콜)",
        example: "DHCP automatically assigns IP addresses.",
      },
      {
        word: "ARP (Address Resolution Protocol)",
        meaning: "ARP",
        example: "ARP maps IP addresses to MAC addresses.",
      },
      {
        word: "HTTP / HTTPS",
        meaning: "HTTP / HTTPS",
        example: "HTTPS encrypts the communication channel.",
      },
      {
        word: "SSL / TLS",
        meaning: "SSL / TLS (보안 프로토콜)",
        example: "TLS ensures secure internet communication.",
      },
      {
        word: "Router",
        meaning: "라우터",
        example: "Routers forward data packets between networks.",
      },
      {
        word: "Switch",
        meaning: "스위치",
        example: "A switch connects devices within a LAN.",
      },
      {
        word: "Gateway",
        meaning: "게이트웨이",
        example: "A gateway acts as an entrance to another network.",
      },
      {
        word: "Subnet Mask",
        meaning: "서브넷 마스크",
        example: "The subnet mask defines the network size.",
      },
      {
        word: "Local Area Network (LAN)",
        meaning: "근거리 통신망",
        example: "Wi-Fi is a common LAN technology.",
      },
      {
        word: "Wide Area Network (WAN)",
        meaning: "광역 통신망",
        example: "The Internet is the largest WAN.",
      },
      {
        word: "Bandwidth",
        meaning: "대역폭",
        example: "High bandwidth allows faster downloads.",
      },
      {
        word: "Throughput",
        meaning: "처리량",
        example: "Throughput is the actual rate of data transfer.",
      },
      {
        word: "Latency",
        meaning: "지연 시간",
        example: "Low latency is important for online gaming.",
      },
      {
        word: "RTT (Round Trip Time)",
        meaning: "왕복 시간",
        example: "Ping measures the RTT to a server.",
      },
      {
        word: "Jitter",
        meaning: "지터 (지연 변이)",
        example: "High jitter can disrupt VoIP calls.",
      },
      {
        word: "Congestion Control",
        meaning: "혼잡 제어",
        example: "TCP uses congestion control to prevent traffic jams.",
      },
      {
        word: "Flow Control",
        meaning: "흐름 제어",
        example: "Flow control manages the data transmission rate.",
      },
      {
        word: "Firewall",
        meaning: "방화벽",
        example: "A firewall blocks unauthorized access.",
      },
      {
        word: "Proxy Server",
        meaning: "프록시 서버",
        example: "A proxy can hide your IP address.",
      },
      {
        word: "VPN (Virtual Private Network)",
        meaning: "가상 사설망",
        example: "VPNs provide secure remote access.",
      },
      {
        word: "NAT (Network Address Translation)",
        meaning: "NAT",
        example: "NAT allows multiple devices to share one public IP.",
      },
      {
        word: "Packet Loss",
        meaning: "패킷 손실",
        example: "Packet loss causes lag in video calls.",
      },
      {
        word: "Ping",
        meaning: "핑",
        example: "Use ping to test network connectivity.",
      },
    ],
  },
];
// 퀴즈 상태 관리
let currentQuestionIndex = 0;
let score = 0;
let shuffledQuestions = [];
let isAnswered = false;
let currentLecture = null;
let timerInterval = null;
let timeLeft = 20;

// DOM 요소 (나중에 초기화)
let lectureSelectionScreen, lectureGrid, recordsList, quizContainer;
let wordCard, wordText, pronounceBtn, optionsContainer;
let scoreDisplay, questionCounter, totalQuestions;
let timerText, timerProgressCircle;
let feedbackModal,
  modalIcon,
  modalTitle,
  modalWord,
  modalMeaning,
  modalExample,
  nextBtn;
let resultScreen,
  finalScore,
  maxScore,
  scorePercentage,
  restartBtn,
  backToLecturesBtn;
let backToLectureBtn, themeToggle;
let calendarContainer, selectedDateRecords, dateRecordsList, selectedDateTitle;
let reviewWordsContainer, reviewCount, noReviewWords, reviewQuizBtn;
let memorizedWordsContainer, memorizedCount, noMemorizedWords;
let addWordLecture, addWordInput, addWordBtn, searchWordBtn;
let wordPreviewCard, previewLoading, previewContent, previewError;
let previewWord, previewPhonetic, previewMeaningInput, previewExample;
let previewCancelBtn, previewAddBtn, previewRetryBtn;
let currentWordData = null;
let chapterList, addChapterBtn, addChapterModal, closeChapterModal, submitChapterBtn, newChapterName;

// 네비게이션 기능 초기화
let navigationInitialized = false;

function initNavigation() {
  if (navigationInitialized) return; // 중복 초기화 방지
  
  try {
    const navLinks = document.querySelectorAll(".nav-link");
    const sections = document.querySelectorAll(".section");

    if (navLinks.length === 0 || sections.length === 0) {
      console.warn("Navigation elements not found");
      return;
    }

    navLinks.forEach((link) => {
      link.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        const targetSection = link.getAttribute("data-section");

        if (!targetSection) return;

        // 활성 링크 업데이트
        navLinks.forEach((l) => l.classList.remove("active"));
        link.classList.add("active");

        // 섹션 표시/숨김
        sections.forEach((section) => {
          section.classList.add("hidden");
        });

        const targetElement = document.getElementById(targetSection);
        if (targetElement) {
          targetElement.classList.remove("hidden");
          
          // 각 섹션별 초기화
          if (targetSection === "home") {
            // Home 섹션은 그냥 표시
        } else if (targetSection === "vocab-quiz") {
          // Vocab Quiz 섹션으로 돌아올 때 챕터 선택 화면 표시
          setTimeout(() => {
            try {
              showLectureSelection();
            } catch (err) {
              console.error("Error showing lecture selection:", err);
            }
          }, 50);
        } else if (targetSection === "voca-review") {
          // Voca Review 섹션으로 갈 때 단어 표시 (챕터 선택 창 없이)
          setTimeout(() => {
            try {
              displayReviewWords();
            } catch (err) {
              console.error("Error displaying review words:", err);
            }
          }, 50);
        }
        }
      });
    });
    
    navigationInitialized = true;
  } catch (error) {
    console.error("Error initializing navigation:", error);
  }
}

// 챕터 목록 업데이트 (사이드바)
function updateChapterList() {
  if (!chapterList) {
    // chapterList가 없으면 조용히 리턴 (에러 방지)
    return;
  }
  
  try {
    chapterList.innerHTML = "";
    vocaData.forEach((lecture, index) => {
      const userWords = getUserAddedWords(lecture.lecture);
      const totalWords = lecture.words.length + userWords.length;
      
      const listItem = document.createElement("div");
      listItem.className = "chapter-list-item";
      listItem.innerHTML = `
        <div class="chapter-item-content">
          <div class="chapter-item-title">${lecture.lecture}</div>
          <div class="chapter-item-count">${totalWords}개</div>
        </div>
        <button class="chapter-test-btn" data-index="${index}">TEST</button>
      `;
      
      const testBtn = listItem.querySelector(".chapter-test-btn");
      if (testBtn) {
        testBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          e.preventDefault();
          const idx = parseInt(testBtn.getAttribute("data-index"));
          if (!isNaN(idx) && idx >= 0 && idx < vocaData.length) {
            startQuiz(idx);
          }
        });
      }
      
      chapterList.appendChild(listItem);
    });
  } catch (error) {
    console.error("Error updating chapter list:", error);
  }
}

// 챕터 선택 화면 표시
function showLectureSelection() {
  try {
    // Vocab Quiz 섹션이 활성화되어 있을 때만 챕터 선택 창 표시
    const vocabQuizSection = document.getElementById("vocab-quiz");
    const isVocabQuizActive = vocabQuizSection && !vocabQuizSection.classList.contains("hidden");
    
    if (!isVocabQuizActive) {
      // Vocab Quiz 섹션이 아니면 챕터 선택 창을 표시하지 않음
      return;
    }
    
    if (lectureSelectionScreen) {
      lectureSelectionScreen.classList.remove("hidden");
    }
    if (quizContainer) {
      quizContainer.classList.add("hidden");
    }
    if (resultScreen) {
      resultScreen.classList.add("hidden");
    }
    if (feedbackModal) {
      feedbackModal.classList.add("hidden");
    }

    // 챕터 목록 업데이트 (사이드바)
    updateChapterList();

    // 단어 추가 챕터 선택 드롭다운 채우기
    if (addWordLecture) {
      addWordLecture.innerHTML = '<option value="">챕터 선택</option>';
      vocaData.forEach((lecture) => {
        const option = document.createElement("option");
        option.value = lecture.lecture;
        option.textContent = lecture.lecture;
        addWordLecture.appendChild(option);
      });
    }

    // 학습 기록 표시
    displayStudyRecords();
  } catch (error) {
    console.error("Error in showLectureSelection:", error);
  }
}

// 학습 기록 표시 (캘린더 형태)
function displayStudyRecords() {
  const records = getStudyRecords();
  if (!calendarContainer) return;

  calendarContainer.innerHTML = "";
  const calendarMonths = document.getElementById("calendar-months");
  if (calendarMonths) {
    calendarMonths.innerHTML = "";
  }

  // 최근 1년간의 데이터 생성
  const today = new Date();
  const oneYearAgo = new Date(today);
  oneYearAgo.setFullYear(today.getFullYear() - 1);

  // 날짜별 단어 개수 집계
  const dateCounts = {};
  records.forEach((record) => {
    // 날짜가 이미 ISO 형식이거나, Date 객체로 변환 가능한 형식인지 확인
    let dateKey;
    if (record.date && record.date.match(/^\d{4}-\d{2}-\d{2}$/)) {
      // 이미 ISO 형식 (YYYY-MM-DD)
      dateKey = record.date;
    } else {
      // 기존 형식 호환성을 위해 Date 객체로 변환 시도
      const date = new Date(record.date);
      if (isNaN(date.getTime())) {
        // 유효하지 않은 날짜는 스킵
        return;
      }
      dateKey = date.toISOString().split("T")[0];
    }

    if (!dateCounts[dateKey]) {
      dateCounts[dateKey] = 0;
    }
    // 점수에서 단어 개수 추출 (예: "5/10" -> 5)
    const wordCount = parseInt(record.score.split("/")[0]) || 0;
    dateCounts[dateKey] += wordCount;
  });

  // 캘린더 그리드 생성 (53주 x 7일)
  const startDate = new Date(oneYearAgo);
  // 일요일로 맞추기
  const startDayOfWeek = startDate.getDay();
  startDate.setDate(startDate.getDate() - startDayOfWeek);

  // 시작 날짜의 타임스탬프 저장 (변경 방지)
  const startTimestamp = startDate.getTime();

  // 월 이름 배열
  const monthNames = [
    "Jan",
    "Feb",
    "Mar",
    "Apr",
    "May",
    "Jun",
    "Jul",
    "Aug",
    "Sep",
    "Oct",
    "Nov",
    "Dec",
  ];

  // 월별 라벨 위치 계산
  const monthPositions = {};

  for (let week = 0; week < 53; week++) {
    for (let day = 0; day < 7; day++) {
      const currentDate = new Date(
        startTimestamp + (week * 7 + day) * 24 * 60 * 60 * 1000,
      );

      if (currentDate > today) continue;

      // 과거 1년 이전의 날짜는 표시하지 않음
      if (currentDate < oneYearAgo) continue;

      const dateKey = currentDate.toISOString().split("T")[0];
      const count = dateCounts[dateKey] || 0;

      // 월 라벨 위치 기록 (각 월의 첫 번째 주)
      const month = currentDate.getMonth();
      const year = currentDate.getFullYear();
      const monthKey = `${year}-${month}`;
      if (!monthPositions[monthKey] && currentDate.getDate() <= 7) {
        monthPositions[monthKey] = { week, month };
      }

      // 날짜 포맷 (툴팁용)
      const monthNum = currentDate.getMonth() + 1;
      const dayNum = currentDate.getDate();
      const tooltipText = `${monthNum}월 ${dayNum}일 - ${count}개 학습`;

      const dayElement = document.createElement("div");
      dayElement.className = "calendar-day";
      dayElement.setAttribute("data-count", Math.min(count, 21)); // 최대 21로 제한
      dayElement.setAttribute("data-date", dateKey);
      dayElement.setAttribute("data-tooltip", tooltipText);

      dayElement.addEventListener("click", () =>
        showDateRecords(dateKey, records),
      );

      calendarContainer.appendChild(dayElement);
    }
  }

  // 월 라벨 생성
  if (calendarMonths) {
    // 주 단위로 간격을 맞추기 위해 빈 라벨 추가
    let lastWeek = -1;
    const sortedMonths = Object.entries(monthPositions).sort(
      (a, b) => a[1].week - b[1].week,
    );

    sortedMonths.forEach(([key, value], index) => {
      const monthLabel = document.createElement("span");
      monthLabel.className = "calendar-month-label";
      monthLabel.textContent = monthNames[value.month];

      // 간격 계산 (각 주는 약 14px 너비)
      const gapWeeks = value.week - (lastWeek + 1);
      if (gapWeeks > 0) {
        monthLabel.style.marginLeft = `${gapWeeks * 14}px`;
      }
      lastWeek = value.week;

      calendarMonths.appendChild(monthLabel);
    });
  }
}

// 특정 날짜의 기록 표시
function showDateRecords(dateKey, allRecords) {
  if (!selectedDateRecords || !dateRecordsList || !selectedDateTitle) return;

  const dateRecords = allRecords.filter((r) => {
    // 날짜 형식 확인
    if (r.date && r.date.match(/^\d{4}-\d{2}-\d{2}$/)) {
      return r.date === dateKey;
    } else {
      const recordDate = new Date(r.date);
      if (isNaN(recordDate.getTime())) {
        return false;
      }
      return recordDate.toISOString().split("T")[0] === dateKey;
    }
  });

  if (dateRecords.length === 0) {
    selectedDateRecords.classList.add("hidden");
    return;
  }

  selectedDateTitle.textContent = `${dateKey} 학습 기록`;
  dateRecordsList.innerHTML = "";

  dateRecords.forEach((record) => {
    const item = document.createElement("div");
    item.className = "date-record-item";
    item.innerHTML = `
      <div class="date-record-lecture">${record.lecture}</div>
      <div class="date-record-score">${record.score}</div>
    `;
    dateRecordsList.appendChild(item);
  });

  selectedDateRecords.classList.remove("hidden");
}

// 학습 기록 가져오기
function getStudyRecords() {
  const records = localStorage.getItem("vocabQuizRecords");
  return records ? JSON.parse(records) : [];
}

// 학습 기록 저장
function saveStudyRecord(lecture, score, maxScore) {
  const records = getStudyRecords();
  // ISO 형식으로 날짜 저장 (YYYY-MM-DD)
  const today = new Date().toISOString().split("T")[0];
  const percentage = Math.round((score / maxScore) * 100);

  records.unshift({
    date: today,
    lecture: lecture,
    score: `${score}/${maxScore} (${percentage}%)`,
  });

  // 최대 50개까지만 저장
  if (records.length > 50) {
    records.pop();
  }

  localStorage.setItem("vocabQuizRecords", JSON.stringify(records));
}

// 틀린 단어 저장
function saveWrongWord(word, meaning, example, lecture) {
  const wrongWords = getWrongWords();

  // 이미 존재하는지 확인 (중복 방지)
  const exists = wrongWords.some(
    (w) => w.word === word && w.lecture === lecture,
  );
  if (exists) return;

  wrongWords.push({
    word: word,
    meaning: meaning,
    example: example,
    lecture: lecture,
    date: new Date().toISOString().split("T")[0],
  });

  localStorage.setItem("vocabWrongWords", JSON.stringify(wrongWords));
}

// 틀린 단어 가져오기
function getWrongWords() {
  const words = localStorage.getItem("vocabWrongWords");
  return words ? JSON.parse(words) : [];
}

// 암기한 단어 저장
function saveMemorizedWord(word, meaning, example, lecture) {
  const memorizedWords = getMemorizedWords();

  // 이미 존재하는지 확인 (중복 방지)
  const exists = memorizedWords.some(
    (w) => w.word === word && w.lecture === lecture,
  );
  if (exists) return;

  memorizedWords.push({
    word: word,
    meaning: meaning,
    example: example,
    lecture: lecture,
    date: new Date().toISOString().split("T")[0],
  });

  localStorage.setItem("vocabMemorizedWords", JSON.stringify(memorizedWords));
}

// 암기한 단어 가져오기
function getMemorizedWords() {
  const words = localStorage.getItem("vocabMemorizedWords");
  return words ? JSON.parse(words) : [];
}

// 틀린 단어 삭제 (암기 완료) - 암기한 단어장에 저장 후 삭제
function removeWrongWord(word, lecture) {
  const wrongWords = getWrongWords();
  const wordData = wrongWords.find(
    (w) => w.word === word && w.lecture === lecture,
  );

  if (wordData) {
    // 암기한 단어장에 저장
    saveMemorizedWord(
      wordData.word,
      wordData.meaning,
      wordData.example,
      wordData.lecture,
    );

    // 틀린 단어장에서 삭제
    const filtered = wrongWords.filter(
      (w) => !(w.word === word && w.lecture === lecture),
    );
    localStorage.setItem("vocabWrongWords", JSON.stringify(filtered));
    displayReviewWords();
  }
}

// 사용자 추가 단어 가져오기
function getUserAddedWords(lectureName) {
  const userWords = localStorage.getItem("vocabUserWords");
  if (!userWords) return [];

  const allUserWords = JSON.parse(userWords);
  return allUserWords.filter((w) => w.lecture === lectureName);
}

// 퀴즈 시작
function startQuiz(lectureIndex, isReviewQuiz = false) {
  if (isReviewQuiz) {
    // Review 퀴즈: 틀린 단어 중 무작위 10개
    const wrongWords = getWrongWords();
    if (wrongWords.length === 0) {
      alert("복습할 단어가 없습니다.");
      return;
    }

    // 무작위로 최대 10개 선택
    const shuffled = [...wrongWords].sort(() => Math.random() - 0.5);
    const selectedWords = shuffled.slice(0, Math.min(10, shuffled.length));

    currentLecture = {
      lecture: "틀린 단어 복습",
      words: selectedWords,
    };
    
    // Voca Review에서는 챕터 선택 창 숨기기
    if (lectureSelectionScreen) {
      lectureSelectionScreen.classList.add("hidden");
    }
  } else {
    // 일반 퀴즈: 선택한 챕터의 단어들
    const originalLecture = vocaData[lectureIndex];
    const userWords = getUserAddedWords(originalLecture.lecture);

    // 원본 단어 + 사용자 추가 단어 합치기
    const allWords = [...originalLecture.words, ...userWords];

    currentLecture = {
      lecture: originalLecture.lecture,
      words: allWords,
    };
  }

  currentQuestionIndex = 0;
  score = 0;
  isAnswered = false;

  // 단어가 10개 이상이면 무작위로 10개만 선택
  let wordsToTest = [...currentLecture.words];
  if (wordsToTest.length > 10) {
    wordsToTest = wordsToTest.sort(() => Math.random() - 0.5).slice(0, 10);
  }

  // 문제 섞기
  shuffledQuestions = wordsToTest.sort(() => Math.random() - 0.5);

  // 화면 전환
  lectureSelectionScreen.classList.add("hidden");
  quizContainer.classList.remove("hidden");
  resultScreen.classList.add("hidden");

  // 점수 및 문제 수 업데이트
  updateScore();
  totalQuestions.textContent = shuffledQuestions.length;

  loadQuestion();
}

// 문제 로드
function loadQuestion() {
  if (currentQuestionIndex >= shuffledQuestions.length) {
    showResult();
    return;
  }

  const question = shuffledQuestions[currentQuestionIndex];
  isAnswered = false;

  // 단어 표시
  wordText.textContent = question.word;

  // 옵션 생성 (정답 + 오답 3개)
  const allMeanings = vocaData.flatMap((l) => l.words.map((w) => w.meaning));
  const wrongOptions = allMeanings
    .filter((m) => m !== question.meaning)
    .sort(() => Math.random() - 0.5)
    .slice(0, 3);
  const options = [question.meaning, ...wrongOptions].sort(
    () => Math.random() - 0.5,
  );

  // 옵션 버튼 생성
  optionsContainer.innerHTML = "";
  options.forEach((option) => {
    const button = document.createElement("button");
    button.className = "option-btn";
    button.textContent = option;
    button.addEventListener("click", () => selectOption(option, question));
    optionsContainer.appendChild(button);
  });

  // 문제 번호 업데이트
  questionCounter.textContent = currentQuestionIndex + 1;

  // 타이머 시작
  startTimer();
}

// 타이머 시작
function startTimer() {
  timeLeft = 20;
  timerText.textContent = timeLeft;

  // 타이머 원형 진행바 초기화
  const circumference = 2 * Math.PI * 45; // 반지름 45
  timerProgressCircle.style.strokeDasharray = circumference;
  timerProgressCircle.style.strokeDashoffset = 0;
  timerProgressCircle.classList.remove("warning");

  // 기존 타이머 정리
  if (timerInterval) {
    clearInterval(timerInterval);
  }

  timerInterval = setInterval(() => {
    timeLeft--;
    timerText.textContent = timeLeft;

    // 진행바 업데이트
    const progress = (20 - timeLeft) / 20;
    const offset = circumference * progress;
    timerProgressCircle.style.strokeDashoffset = offset;

    // 5초 이하일 때 경고 색상
    if (timeLeft <= 5) {
      timerProgressCircle.classList.add("warning");
    }

    // 시간 종료
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      if (!isAnswered) {
        // 시간 초과 처리 - 오답으로 처리하고 모달 표시
        isAnswered = true;
        const question = shuffledQuestions[currentQuestionIndex];
        const allButtons = optionsContainer.querySelectorAll(".option-btn");
        allButtons.forEach((btn) => {
          btn.disabled = true;
          if (btn.textContent === question.meaning) {
            btn.classList.add("correct");
          }
        });
        // 시간 초과도 틀린 단어로 저장
        saveWrongWord(
          question.word,
          question.meaning,
          question.example,
          currentLecture.lecture,
        );
        showFeedback(false, question);
      }
    }
  }, 1000);
}

// 옵션 선택
function selectOption(selectedOption, question) {
  if (isAnswered) return;

  isAnswered = true;
  clearInterval(timerInterval);

  const allButtons = optionsContainer.querySelectorAll(".option-btn");
  allButtons.forEach((btn) => {
    btn.disabled = true;
  });

  const isCorrect = selectedOption === question.meaning;

  if (isCorrect) {
    // 정답일 때는 버튼 색상만 변경하고 자동으로 다음 문제로
    allButtons.forEach((btn) => {
      if (btn.textContent === question.meaning) {
        btn.classList.add("correct");
      }
    });
    score++;
    updateScore();

    // Voca Review 테스트인 경우 맞힌 단어를 암기완료 처리
    if (currentLecture && currentLecture.lecture === "틀린 단어 복습") {
      // 틀린 단어장에서 제거하고 암기한 단어장에 추가
      const wrongWords = getWrongWords();
      const wordToRemove = wrongWords.find(
        (w) => w.word === question.word
      );
      if (wordToRemove) {
        removeWrongWord(question.word, wordToRemove.lecture);
      }
    }

    // 1초 후 자동으로 다음 문제로
    setTimeout(() => {
      currentQuestionIndex++;
      loadQuestion();
    }, 1000);
  } else {
    // 오답일 때는 모달 표시 및 틀린 단어 저장
    allButtons.forEach((btn) => {
      if (btn.textContent === selectedOption) {
        btn.classList.add("incorrect");
      }
      if (btn.textContent === question.meaning) {
        btn.classList.add("correct");
      }
    });
    // 틀린 단어 저장
    saveWrongWord(
      question.word,
      question.meaning,
      question.example,
      currentLecture.lecture,
    );
    showFeedback(false, question);
  }
}

// 피드백 모달 표시
function showFeedback(isCorrect, question, selectedOption = null) {
  // 모달 내용 설정
  if (isCorrect) {
    modalIcon.textContent = "✓";
    modalIcon.className = "modal-icon correct";
    modalTitle.textContent = "정답입니다!";
  } else {
    modalIcon.textContent = "✗";
    modalIcon.className = "modal-icon incorrect";
    modalTitle.textContent = "오답입니다";
  }

  modalWord.textContent = question.word;
  modalMeaning.textContent = question.meaning;
  modalExample.textContent = question.example;

  // 모달 표시
  feedbackModal.classList.remove("hidden");
}

// 이벤트 리스너는 initVocabQuiz에서 설정됨

// 점수 업데이트
function updateScore() {
  scoreDisplay.textContent = score;
}

// 결과 화면 표시
function showResult() {
  quizContainer.classList.add("hidden");
  resultScreen.classList.remove("hidden");

  const maxScoreValue = shuffledQuestions.length;
  finalScore.textContent = score;
  maxScore.textContent = maxScoreValue;

  const percentage = Math.round((score / maxScoreValue) * 100);
  scorePercentage.textContent = `${percentage}%`;

  // 결과에 따른 메시지
  let message = "";
  if (percentage >= 90) {
    message = "완벽합니다! 🎉";
  } else if (percentage >= 70) {
    message = "잘하셨습니다! 👍";
  } else if (percentage >= 50) {
    message = "좋은 시도였습니다! 💪";
  } else {
    message = "다시 도전해보세요! 📚";
  }

  scorePercentage.innerHTML = `${percentage}%<br><div style="margin-top: 1rem; font-size: 1.3rem; color: var(--accent);">${message}</div>`;

  // 학습 기록 저장
  saveStudyRecord(currentLecture.lecture, score, maxScoreValue);
}

// Voca Review 단어 표시
function displayReviewWords() {
  // 틀린 단어 표시
  const wrongWords = getWrongWords();

  if (!reviewWordsContainer || !reviewCount || !noReviewWords) return;

  if (wrongWords.length === 0) {
    reviewWordsContainer.innerHTML = "";
    reviewCount.textContent = "0";
    noReviewWords.classList.remove("hidden");
  } else {
    noReviewWords.classList.add("hidden");
    reviewCount.textContent = wrongWords.length;
    reviewWordsContainer.innerHTML = "";

    wrongWords.forEach((wordData, index) => {
      const card = document.createElement("div");
      card.className = "review-word-card";
      card.innerHTML = `
        <div class="review-word-header">
          <div>
            <div class="review-word">${wordData.word}</div>
            <div class="review-meaning">${wordData.meaning}</div>
          </div>
        </div>
        <div class="review-example">${wordData.example}</div>
        <div class="review-lecture">출처: ${wordData.lecture}</div>
        <button class="memorized-btn" data-word="${wordData.word}" data-lecture="${wordData.lecture}">
          암기 완료
        </button>
      `;

      const memorizedBtn = card.querySelector(".memorized-btn");
      memorizedBtn.addEventListener("click", () => {
        removeWrongWord(wordData.word, wordData.lecture);
      });

      reviewWordsContainer.appendChild(card);
    });
  }

  // 외운 단어 표시
  displayMemorizedWords();
}

// 외운 단어 표시
function displayMemorizedWords() {
  const memorizedWords = getMemorizedWords();

  if (!memorizedWordsContainer || !memorizedCount || !noMemorizedWords) return;

  if (memorizedWords.length === 0) {
    memorizedWordsContainer.innerHTML = "";
    memorizedCount.textContent = "0";
    noMemorizedWords.classList.remove("hidden");
    return;
  }

  noMemorizedWords.classList.add("hidden");
  memorizedCount.textContent = memorizedWords.length;
  memorizedWordsContainer.innerHTML = "";

  memorizedWords.forEach((wordData, index) => {
    const card = document.createElement("div");
    card.className = "review-word-card memorized-card";
    card.innerHTML = `
      <div class="review-word-header">
        <div>
          <div class="review-word">${wordData.word}</div>
          <div class="review-meaning">${wordData.meaning}</div>
        </div>
      </div>
      <div class="review-example">${wordData.example}</div>
      <div class="review-lecture">출처: ${wordData.lecture}</div>
      <button class="delete-memorized-btn" data-word="${wordData.word}" data-lecture="${wordData.lecture}">
        삭제
      </button>
    `;

    const deleteBtn = card.querySelector(".delete-memorized-btn");
    deleteBtn.addEventListener("click", () => {
      if (confirm("이 단어를 삭제하시겠습니까?")) {
        deleteMemorizedWord(wordData.word, wordData.lecture);
      }
    });

    memorizedWordsContainer.appendChild(card);
  });
}

// 외운 단어 삭제
function deleteMemorizedWord(word, lecture) {
  const memorizedWords = getMemorizedWords();
  const filtered = memorizedWords.filter(
    (w) => !(w.word === word && w.lecture === lecture)
  );
  localStorage.setItem("vocabMemorizedWords", JSON.stringify(filtered));
  displayMemorizedWords();
}

// 다크모드/라이트모드 토글
function toggleTheme() {
  const body = document.body;
  const isLight = body.classList.contains("light-mode");

  if (isLight) {
    body.classList.remove("light-mode");
    localStorage.setItem("theme", "dark");
  } else {
    body.classList.add("light-mode");
    localStorage.setItem("theme", "light");
  }
}

// 테마 초기화
function initTheme() {
  const savedTheme = localStorage.getItem("theme");
  if (savedTheme === "light") {
    document.body.classList.add("light-mode");
  }
}

// DOM 요소 초기화
function initDOMElements() {
  lectureSelectionScreen = document.getElementById("lecture-selection-screen");
  lectureGrid = document.getElementById("lecture-grid");
  recordsList = document.getElementById("records-list");
  quizContainer = document.getElementById("quiz-container");
  wordCard = document.getElementById("word-card");
  wordText = document.getElementById("word-text");
  pronounceBtn = document.getElementById("pronounce-btn");
  optionsContainer = document.getElementById("options-container");
  scoreDisplay = document.getElementById("score");
  questionCounter = document.getElementById("current-question");
  totalQuestions = document.getElementById("total-questions");
  timerText = document.getElementById("timer-text");
  timerProgressCircle = document.getElementById("timer-progress");
  feedbackModal = document.getElementById("feedback-modal");
  modalIcon = document.getElementById("modal-icon");
  modalTitle = document.getElementById("modal-title");
  modalWord = document.getElementById("modal-word");
  modalMeaning = document.getElementById("modal-meaning");
  modalExample = document.getElementById("modal-example");
  nextBtn = document.getElementById("next-btn");
  resultScreen = document.getElementById("result-screen");
  finalScore = document.getElementById("final-score");
  maxScore = document.getElementById("max-score");
  scorePercentage = document.getElementById("score-percentage");
  restartBtn = document.getElementById("restart-btn");
  backToLecturesBtn = document.getElementById("back-to-lectures-btn");
  backToLectureBtn = document.getElementById("back-to-lecture-btn");
  themeToggle = document.getElementById("theme-toggle");
  calendarContainer = document.getElementById("calendar-container");
  selectedDateRecords = document.getElementById("selected-date-records");
  dateRecordsList = document.getElementById("date-records-list");
  selectedDateTitle = document.getElementById("selected-date-title");
  reviewWordsContainer = document.getElementById("review-words-container");
  reviewCount = document.getElementById("review-count");
  noReviewWords = document.getElementById("no-review-words");
  reviewQuizBtn = document.getElementById("review-quiz-btn");
  memorizedWordsContainer = document.getElementById("memorized-words-container");
  memorizedCount = document.getElementById("memorized-count");
  noMemorizedWords = document.getElementById("no-memorized-words");
  addWordLecture = document.getElementById("add-word-lecture");
  addWordInput = document.getElementById("add-word-input");
  searchWordBtn = document.getElementById("search-word-btn");
  wordPreviewCard = document.getElementById("word-preview-card");
  previewLoading = document.getElementById("preview-loading");
  previewContent = document.getElementById("preview-content");
  previewError = document.getElementById("preview-error");
  previewWord = document.getElementById("preview-word");
  previewPhonetic = document.getElementById("preview-phonetic");
  previewMeaningInput = document.getElementById("preview-meaning-input");
  previewExample = document.getElementById("preview-example");
  previewCancelBtn = document.getElementById("preview-cancel-btn");
  previewAddBtn = document.getElementById("preview-add-btn");
  previewRetryBtn = document.getElementById("preview-retry-btn");
  chapterList = document.getElementById("chapter-list");
  addChapterBtn = document.getElementById("add-chapter-btn");
  addChapterModal = document.getElementById("add-chapter-modal");
  closeChapterModal = document.getElementById("close-chapter-modal");
  submitChapterBtn = document.getElementById("submit-chapter-btn");
  newChapterName = document.getElementById("new-chapter-name");
}

// 페이지 로드 시 챕터 선택 화면 표시
let vocabQuizInitialized = false;

function initVocabQuiz() {
  if (vocabQuizInitialized) return; // 중복 초기화 방지
  
  try {
    // DOM 요소 초기화
    initDOMElements();
    
    // 네비게이션 초기화
    initNavigation();
  
  // 이벤트 리스너 설정
  if (nextBtn) {
    nextBtn.addEventListener("click", () => {
      if (feedbackModal) {
        feedbackModal.classList.add("hidden");
      }
      currentQuestionIndex++;
      loadQuestion();
    });
  }
  
  if (pronounceBtn && wordText) {
    pronounceBtn.addEventListener("click", () => {
      const word = wordText.textContent;
      if (word && "speechSynthesis" in window) {
        const utterance = new SpeechSynthesisUtterance(word);
        utterance.lang = "en-US";
        utterance.rate = 0.9;
        speechSynthesis.speak(utterance);
      }
    });
  }
  
  if (restartBtn) {
    restartBtn.addEventListener("click", () => {
      if (currentLecture) {
        // Review 퀴즈인지 확인
        if (currentLecture.lecture === "틀린 단어 복습") {
          startQuiz(0, true);
        } else {
          const lectureIndex = vocaData.findIndex(
            (l) => l.lecture === currentLecture.lecture,
          );
          if (lectureIndex !== -1) {
            startQuiz(lectureIndex);
          }
        }
      }
    });
  }
  
  if (backToLecturesBtn) {
    backToLecturesBtn.addEventListener("click", () => {
      showLectureSelection();
    });
  }
  
  if (backToLectureBtn) {
    backToLectureBtn.addEventListener("click", () => {
      if (
        confirm("진행 중인 퀴즈를 중단하고 챕터 선택으로 돌아가시겠습니까?")
      ) {
        if (timerInterval) {
          clearInterval(timerInterval);
        }
        showLectureSelection();
      }
    });
  }
  
  if (themeToggle) {
    themeToggle.addEventListener("click", toggleTheme);
  }
  
  // 단어 검색 버튼
  if (searchWordBtn) {
    searchWordBtn.addEventListener("click", searchWord);
  }
  
  // Enter 키로 검색
  if (addWordInput) {
    addWordInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        searchWord();
      }
    });
  }
  
  // Preview 취소 버튼
  if (previewCancelBtn) {
    previewCancelBtn.addEventListener("click", () => {
      hidePreview();
    });
  }
  
  // Preview 추가 버튼
  if (previewAddBtn) {
    previewAddBtn.addEventListener("click", addWordFromPreview);
  }
  
  // Preview 재시도 버튼
  if (previewRetryBtn) {
    previewRetryBtn.addEventListener("click", () => {
      if (addWordInput && addWordInput.value.trim()) {
        searchWord();
      }
    });
  }

  // 챕터 추가 버튼
  if (addChapterBtn) {
    addChapterBtn.addEventListener("click", () => {
      if (addChapterModal) {
        addChapterModal.classList.remove("hidden");
      }
      if (newChapterName) {
        newChapterName.value = "";
        newChapterName.focus();
      }
    });
  }

  // 챕터 추가 모달 닫기
  if (closeChapterModal) {
    closeChapterModal.addEventListener("click", () => {
      if (addChapterModal) {
        addChapterModal.classList.add("hidden");
      }
    });
  }

  // 챕터 추가 제출
  if (submitChapterBtn) {
    submitChapterBtn.addEventListener("click", () => {
      const chapterName = newChapterName ? newChapterName.value.trim() : "";
      if (!chapterName) {
        alert("챕터 이름을 입력해주세요.");
        return;
      }

      // 중복 확인
      const exists = vocaData.some((l) => l.lecture === chapterName);
      if (exists) {
        alert("이미 존재하는 챕터입니다.");
        return;
      }

      // 새 챕터 추가
      vocaData.push({
        lecture: chapterName,
        words: [],
      });

      // 모달 닫기
      if (addChapterModal) {
        addChapterModal.classList.add("hidden");
      }

      alert("✅ 챕터가 추가되었습니다!");
      
      // 챕터 목록 새로고침
      showLectureSelection();
    });
  }

  // Enter 키로 챕터 추가
  if (newChapterName) {
    newChapterName.addEventListener("keypress", (e) => {
      if (e.key === "Enter" && submitChapterBtn) {
        submitChapterBtn.click();
      }
    });
  }

  // Review 퀴즈 버튼
  if (reviewQuizBtn) {
    reviewQuizBtn.addEventListener("click", () => {
      const wrongWords = getWrongWords();
      if (wrongWords.length === 0) {
        alert("복습할 단어가 없습니다.");
        return;
      }

      // Vocab Quiz 섹션으로 이동
      const navLinks = document.querySelectorAll(".nav-link");
      const sections = document.querySelectorAll(".section");

      navLinks.forEach((l) => l.classList.remove("active"));
      const vocabQuizLink = Array.from(navLinks).find(
        (l) => l.getAttribute("data-section") === "vocab-quiz",
      );
      if (vocabQuizLink) {
        vocabQuizLink.classList.add("active");
      }

      sections.forEach((s) => s.classList.add("hidden"));
      const vocabQuizSection = document.getElementById("vocab-quiz");
      if (vocabQuizSection) {
        vocabQuizSection.classList.remove("hidden");
      }

      // 챕터 선택 창 숨기기 (Review 퀴즈이므로)
      if (lectureSelectionScreen) {
        lectureSelectionScreen.classList.add("hidden");
      }
      if (quizContainer) {
        quizContainer.classList.remove("hidden");
      }

      // Review 퀴즈 시작
      startQuiz(0, true);
    });
  }

  // 테마 초기화
  initTheme();

  // 초기 상태 설정
  if (lectureSelectionScreen) {
    lectureSelectionScreen.classList.remove("hidden");
  }
  if (quizContainer) {
    quizContainer.classList.add("hidden");
  }
  if (resultScreen) {
    resultScreen.classList.add("hidden");
  }
  if (feedbackModal) {
    feedbackModal.classList.add("hidden");
  }

    // 챕터 목록 초기화
    showLectureSelection();
    
    vocabQuizInitialized = true;
  } catch (error) {
    console.error("Error initializing Vocab Quiz:", error);
    // 최소한의 기능이라도 작동하도록
    if (lectureSelectionScreen) {
      lectureSelectionScreen.classList.remove("hidden");
    }
  }
}

// 단어 검색 함수 (네이버 영한사전 스타일)
async function searchWord() {
  const word = addWordInput ? addWordInput.value.trim() : "";

  if (!word) {
    alert("단어를 입력해주세요.");
    return;
  }

  // Preview 카드 표시 및 로딩 상태 초기화
  if (!wordPreviewCard) {
    console.error("wordPreviewCard not found");
    return;
  }
  
  if (!previewLoading || !previewContent || !previewError) {
    console.error("Preview elements not initialized");
    return;
  }
  
  wordPreviewCard.classList.remove("hidden");
  previewLoading.classList.remove("hidden");
  previewContent.classList.add("hidden");
  previewError.classList.add("hidden");

  try {
    // 네이버 영한사전 페이지에서 데이터 가져오기 (CORS 문제로 직접 접근 불가)
    // 대신 Free Dictionary API로 기본 정보를 가져온 후 네이버 사전 링크 제공
    
    // Free Dictionary API 사용
    const response = await fetch(
      `https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(word)}`,
      {
        method: 'GET',
        headers: {
          'Accept': 'application/json'
        }
      }
    );

    if (!response.ok) {
      throw new Error("Word not found");
    }

    const data = await response.json();

    if (data && data.length > 0) {
      const wordData = data[0];

      // 단어 정보 추출
      const wordText = wordData.word || word;
      const phonetic =
        wordData.phonetic ||
        (wordData.phonetics && wordData.phonetics[0]?.text) ||
        "";

      // 품사와 뜻 추출 (네이버 영한사전 스타일)
      let koreanMeaning = "";
      let partOfSpeech = "";
      let example = "";
      
      if (wordData.meanings && wordData.meanings.length > 0) {
        // 첫 번째 의미의 품사 가져오기
        partOfSpeech = wordData.meanings[0].partOfSpeech || "";
        
        // 모든 의미를 수집하고 예문도 적극적으로 찾기
        const allMeanings = [];
        
        // 먼저 예문을 찾기 (모든 meanings와 definitions를 순회)
        for (const meaningItem of wordData.meanings) {
          if (meaningItem.definitions && meaningItem.definitions.length > 0) {
            for (const def of meaningItem.definitions) {
              // 정의 수집
              if (def.definition) {
                allMeanings.push(def.definition);
              }
              // 예문 찾기 (우선순위: example 필드)
              if (!example && def.example && def.example.trim() !== "") {
                example = def.example.trim();
                break; // 첫 번째 예문을 찾으면 중단
              }
            }
            if (example) break; // 예문을 찾으면 전체 루프 중단
          }
        }
        
        // 첫 번째 뜻을 한국어로 번역 시도 (영한사전 스타일 - 간결하게)
        if (allMeanings.length > 0) {
          try {
            // 첫 번째 정의만 사용 (간결하게)
            const firstDefinition = allMeanings[0];
            
            // 여러 번역 API를 순차적으로 시도
            let translationSuccess = false;
            
            // 1차 시도: MyMemory Translation API
            try {
              const translateResponse = await fetch(
                `https://api.mymemory.translated.net/get?q=${encodeURIComponent(firstDefinition)}&langpair=en|ko`,
                {
                  method: 'GET',
                  headers: {
                    'Accept': 'application/json'
                  }
                }
              );
              
              if (translateResponse.ok) {
                const translateData = await translateResponse.json();
                if (translateData.responseData && translateData.responseData.translatedText) {
                  let translated = translateData.responseData.translatedText;
                  
                  // 번역 품질 검증
                  if (translated !== firstDefinition && translated.length >= 2) {
                    // 한글 뜻을 간결하게 처리
                    if (translated.length > 50) {
                      const firstSentence = translated.split(/[.,;]/)[0].trim();
                      koreanMeaning = firstSentence.length > 0 && firstSentence.length <= 50 
                        ? firstSentence 
                        : translated.substring(0, 47) + "...";
                    } else {
                      koreanMeaning = translated;
                    }
                    translationSuccess = true;
                  }
                }
              }
            } catch (e1) {
              console.log("MyMemory API failed:", e1);
            }
            
            // 2차 시도: LibreTranslate API (무료)
            if (!translationSuccess) {
              try {
                const libreResponse = await fetch(
                  `https://libretranslate.de/translate`,
                  {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                      q: firstDefinition,
                      source: 'en',
                      target: 'ko',
                      format: 'text'
                    })
                  }
                );
                
                if (libreResponse.ok) {
                  const libreData = await libreResponse.json();
                  if (libreData.translatedText) {
                    let translated = libreData.translatedText;
                    if (translated.length > 50) {
                      const firstSentence = translated.split(/[.,;]/)[0].trim();
                      koreanMeaning = firstSentence.length > 0 && firstSentence.length <= 50 
                        ? firstSentence 
                        : translated.substring(0, 47) + "...";
                    } else {
                      koreanMeaning = translated;
                    }
                    translationSuccess = true;
                  }
                }
              } catch (e2) {
                console.log("LibreTranslate API failed:", e2);
              }
            }
            
            // 모든 번역 API 실패 시 영어 뜻 사용
            if (!translationSuccess) {
              koreanMeaning = firstDefinition;
            }
          } catch (e) {
            console.log("Translation failed:", e);
            koreanMeaning = allMeanings[0];
          }
        }
      }
      
      // 번역이 실패했으면 영어 뜻 사용
      if (!koreanMeaning) {
        koreanMeaning = "뜻을 찾을 수 없습니다.";
      }
      
      // 품사와 뜻을 함께 표시 (네이버 영한사전 스타일 - 간결하게)
      const partOfSpeechText = partOfSpeech ? `[${partOfSpeech}] ` : "";
      
      // 한글 뜻이 너무 길면 자르기 (최대 50자)
      let finalMeaning = koreanMeaning;
      if (finalMeaning.length > 50) {
        // 첫 번째 문장이나 의미 단위로 자르기
        const firstPart = finalMeaning.split(/[.,;]/)[0].trim();
        finalMeaning = firstPart.length > 0 && firstPart.length <= 50 
          ? firstPart 
          : finalMeaning.substring(0, 47) + "...";
      }
      
      koreanMeaning = partOfSpeechText + finalMeaning;
      
      // 예문 검증: 예문이 실제 예문인지 확인 (뜻이 아닌 실제 문장인지)
      if (!example || example.trim() === "" || example.length < 10) {
        // 예문이 없거나 너무 짧으면 의미 있는 기본 예문 생성
        example = `Example: ${wordText} is an important word.`;
      } else {
        // 예문이 있으면 그대로 사용 (이미 API에서 가져온 실제 예문)
        example = example.trim();
      }
      
      // Preview에 데이터 표시
      currentWordData = {
        word: wordText,
        meaning: koreanMeaning,
        example: example,
        phonetic: phonetic,
        naverDictUrl: `https://en.dict.naver.com/#/search?query=wordText`
      };

      // 로딩 완료 처리 - 반드시 마지막에 실행
      displayPreview(currentWordData);
    } else {
      throw new Error("Word not found");
    }
  } catch (error) {
    console.error("Search error:", error);
    // 에러 표시 및 로딩 숨기기 - 확실하게 처리
    // 즉시 실행
    if (previewLoading) {
      previewLoading.classList.add("hidden");
    }
    if (previewContent) {
      previewContent.classList.add("hidden");
    }
    if (previewError) {
      previewError.classList.remove("hidden");
    }
    // 추가 보장
    setTimeout(() => {
      if (previewLoading) {
        previewLoading.classList.add("hidden");
      }
      if (previewContent) {
        previewContent.classList.add("hidden");
      }
      if (previewError) {
        previewError.classList.remove("hidden");
      }
    }, 100);
  }
}

// Preview 표시
function displayPreview(wordData) {
  if (!previewWord || !previewMeaningInput || !previewExample) {
    console.error("Preview elements not found");
    return;
  }

  previewWord.textContent = wordData.word || "";
  previewPhonetic.textContent = wordData.phonetic
    ? `[${wordData.phonetic}]`
    : "";
  previewMeaningInput.value = wordData.meaning || "";
  
  // 예문 표시: 실제 예문인지 확인 (뜻이 아닌 실제 문장인지)
  const exampleText = wordData.example || "";
  // 예문이 뜻과 같은지 확인 (예문이 뜻으로 잘못 들어간 경우 방지)
  const isRealExample = exampleText && 
                        exampleText.trim() !== "" && 
                        !exampleText.includes(" - ") && 
                        !exampleText.toLowerCase().startsWith(wordData.word.toLowerCase() + " -") &&
                        exampleText.length > wordData.meaning.length;
  
  if (isRealExample) {
    // 실제 예문인 경우
    previewExample.textContent = exampleText;
  } else {
    // 예문이 없거나 기본값인 경우 - 단어를 포함한 간단한 예문 생성
    previewExample.textContent = `Example: ${wordData.word} is used in various contexts.`;
  }

  // 네이버 영어사전 링크 추가 (있는 경우)
  const previewHeader = document.querySelector(".preview-header");
  if (previewHeader) {
    // 기존 링크가 있으면 제거
    const existingLink = previewHeader.querySelector(".naver-dict-link");
    if (existingLink) {
      existingLink.remove();
    }
    
    // 네이버 영어사전 링크 추가
    if (wordData.naverDictUrl) {
      const naverLink = document.createElement("a");
      naverLink.href = wordData.naverDictUrl;
      naverLink.target = "_blank";
      naverLink.rel = "noopener noreferrer";
      naverLink.className = "naver-dict-link";
      naverLink.innerHTML = `
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
          <polyline points="15 3 21 3 21 9"></polyline>
          <line x1="10" y1="14" x2="21" y2="3"></line>
        </svg>
        네이버 영한사전에서 보기
      `;
      previewHeader.appendChild(naverLink);
    }
  }

  // 로딩 완료 처리 - 반드시 마지막에 실행 (확실하게)
  // 즉시 실행하고 추가로 setTimeout으로도 보장
  if (previewLoading) {
    previewLoading.classList.add("hidden");
  }
  if (previewError) {
    previewError.classList.add("hidden");
  }
  if (previewContent) {
    previewContent.classList.remove("hidden");
  }
  
  // 추가 보장을 위한 setTimeout
  setTimeout(() => {
    if (previewLoading) {
      previewLoading.classList.add("hidden");
    }
    if (previewError) {
      previewError.classList.add("hidden");
    }
    if (previewContent) {
      previewContent.classList.remove("hidden");
    }
  }, 100);
}

// Preview 숨기기
function hidePreview() {
  if (wordPreviewCard) {
    wordPreviewCard.classList.add("hidden");
  }
  if (addWordInput) {
    addWordInput.value = "";
  }
  currentWordData = null;
}

// Preview에서 단어 추가
function addWordFromPreview() {
  if (!currentWordData) return;

  const lecture = addWordLecture ? addWordLecture.value : "";

  if (!lecture) {
    alert("챕터를 선택해주세요.");
    return;
  }

  // 사용자 단어 저장
  const userWords = JSON.parse(localStorage.getItem("vocabUserWords") || "[]");

  // 중복 확인
  const exists = userWords.some(
    (w) =>
      w.word.toLowerCase() === currentWordData.word.toLowerCase() &&
      w.lecture === lecture,
  );

  if (exists) {
    alert("이미 추가된 단어입니다.");
    return;
  }

  // 사용자가 수정한 뜻 가져오기
  const finalMeaning = previewMeaningInput ? previewMeaningInput.value.trim() : currentWordData.meaning;
  
  userWords.push({
    word: currentWordData.word,
    meaning: finalMeaning || currentWordData.meaning,
    example: currentWordData.example,
    lecture: lecture,
    date: new Date().toISOString().split("T")[0],
  });

  localStorage.setItem("vocabUserWords", JSON.stringify(userWords));

  // 성공 메시지
  alert("✅ 단어가 추가되었습니다!");

  // Preview 숨기기 및 초기화
  hidePreview();

  // 챕터 목록 새로고침
  showLectureSelection();
}

// DOM 로드 완료 시 또는 이미 로드된 경우
(function() {
  try {
    initTheme();
    
    function init() {
      try {
        initVocabQuiz();
      } catch (error) {
        console.error("Error in initVocabQuiz:", error);
      }
    }
    
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", () => {
        setTimeout(init, 200);
      });
    } else {
      setTimeout(init, 200);
    }
  } catch (error) {
    console.error("Error initializing app:", error);
  }
})();
